%auto-ignore
\begin{tikzpicture}
\tikzset{decorate sep/.style 2 args=
{decorate,decoration={shape backgrounds,shape=circle,shape size=#1,shape sep=#2}}}

 \def\ecc{0.1} % eccentricity of bdd
    \def\gencanc{0.05} % legth of extra line in genus
  \def\genecc{20} % eccentricity of genus
  \def\distI{0.25}
  \def\radI{0.5}
  \def\radIII{0.2}
  \def\eccI{0.1}  
  \def\gencancI{0.05} % legth of extra line in genus
  \def\geneccI{20} % eccentricity of genus
  \def\genradI{0.45} % radius of genus
  \def\mezI{0.4} %Mezera mezi sousednimi nozkami s elipsou
  \def\mezII{3.8} % Mezera mezi dvema MC
  \def\mezIII{0.3} % Mezera na MC mala
  \def\mezIV{0.8} % Mezera mezi cylindry
  \def\mezV{0.1} % canc pro tri teck
  \def\triI{0.2mm}
  \def\triII{0.6mm}
  \def\vysI{1} % Vyska cylindru a velke operace
  \def\vysII{0.2} % Dolni vyska MC
  \def\vysIII{1} % Horni vyska MC
  \def\distIII{3*\radI} % Distance of MC genus
  
% TOP 
  
  \coordinate (A1) at (0,0);
  \coordinate (A2) at ($(A1)+(2*\radI,0)$);
  \coordinate (A3) at ($(A2)+(\mezI,0)$);
  \coordinate (A4) at ($(A3)+(2*\radI,0)$);
  \coordinate (A5) at ($(A4)+(\mezIII,0)$);
  \coordinate (A6) at ($(A5)+(2*\radI,0)$);
  \coordinate (A7) at ($(A6)+(\mezI,0)$);
  \coordinate (A8) at ($(A7)+(2*\radI,0)$);
  \coordinate (A9) at ($(A8)+(\mezI,0)$);
  
  
  \coordinate (B1) at ($(A1)+(0,-\vysI)$);
  \coordinate (B2) at ($(B1)+(2*\radI,0)$);
  \coordinate (B3) at ($(B2)+(\mezI,0)$);
  \coordinate (B4) at ($(B3)+(2*\radI,0)$);
  \coordinate (B5) at ($(B4)+(\mezIII,0)$);
  \coordinate (B6) at ($(B5)+(2*\radI,0)$);
  \coordinate (B7) at ($(B6)+(\mezI,0)$);
  \coordinate (B8) at ($(B7)+(2*\radI,0)$);
  \coordinate (B9) at ($(B8)+(\mezI,0)$);
  
  \coordinate (C1) at ($(B5)+(0,-\distI)$);
  \coordinate (C2) at ($(C1)+(2*\radI,0)$);
  \coordinate (C3) at ($(C2)+(\mezI,0)$);
  \coordinate (C4) at ($(C3)+(2*\radI,0)$);
  \coordinate (C5) at ($(C4)+(\mezIII,0)$);
  \coordinate (C6) at ($(C5)+(2*\radI,0)$);
  \coordinate (C7) at ($(C6)+(\mezI,0)$);
  \coordinate (C8) at ($(C7)+(2*\radI,0)$);
  \coordinate (C9) at ($(C8)+(\mezI,0)$);
  
  
  \coordinate (D1) at ($(C1)+(0,-\vysI)$);
  \coordinate (D2) at ($(D1)+(2*\radI,0)$);
  \coordinate (D3) at ($(D2)+(\mezI,0)$);
  \coordinate (D4) at ($(D3)+(2*\radI,0)$);
  \coordinate (D5) at ($(D4)+(\mezIII,0)$);
  \coordinate (D6) at ($(D5)+(2*\radI,0)$);
  \coordinate (D7) at ($(D6)+(\mezI,0)$);
  \coordinate (D8) at ($(D7)+(2*\radI,0)$);
  \coordinate (D9) at ($(D8)+(\mezI,0)$);
  
\draw (A1) arc (180:360:{\radI} and {\ecc});
\draw (A1) arc (180:0:{\radI} and {\ecc});
\draw (A3) arc (180:360:{\radI} and {\ecc});
\draw (A3) arc (180:0:{\radI} and {\ecc});
\draw (A5) arc (180:360:{\radI} and {\ecc});
\draw (A5) arc (180:0:{\radI} and {\ecc});
\draw (A7) arc (180:360:{\radI} and {\ecc});
\draw (A7) arc (180:0:{\radI} and {\ecc});

\draw (C1) arc (180:360:{\radI} and {\ecc});
\draw (C1) arc (180:0:{\radI} and {\ecc});
\draw (C3) arc (180:360:{\radI} and {\ecc});
\draw (C3) arc (180:0:{\radI} and {\ecc});
\draw (C5) arc (180:360:{\radI} and {\ecc});
\draw (C5) arc (180:0:{\radI} and {\ecc});
\draw (C7) arc (180:360:{\radI} and {\ecc});
\draw (C7) arc (180:0:{\radI} and {\ecc});

\draw (D1) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (D1) arc (180:0:{\radI} and {\ecc});
\draw (D3) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (D3) arc (180:0:{\radI} and {\ecc});
\draw (D5) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (D5) arc (180:0:{\radI} and {\ecc});
\draw (D7) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (D7) arc (180:0:{\radI} and {\ecc});

\draw (B1) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (B1) arc (180:0:{\radI} and {\ecc});
\draw (B3) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (B3) arc (180:0:{\radI} and {\ecc});
\draw (B5) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (B5) arc (180:0:{\radI} and {\ecc});
\draw (B7) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (B7) arc (180:0:{\radI} and {\ecc});

\draw (A1)--(B1);
\draw (A8)--(B8);
\draw (C1)--(D1);
\draw (C8)--(D8);

\draw (A4) to[out=-90,in=-90] (A5);
\draw (C4) to[out=-90,in=-90] (C5);
\draw (B4) to[out=90,in=90] (B5);
\draw (D4) to[out=90,in=90] (D5);

\draw[decorate sep={\triI}{\triII},fill] ($(A2)+(\mezV,0)$) to ($(A3)+(-\mezV,0)$);

\draw[decorate sep={\triI}{\triII},fill] ($(A6)+(\mezV,0)$) to ($(A7)+(-\mezV,0)$);

\draw[decorate sep={\triI}{\triII},fill] ($(B2)+(\mezV,0)$) to ($(B3)+(-\mezV,0)$);

\draw[decorate sep={\triI}{\triII},fill] ($(B6)+(\mezV,0)$) to ($(B7)+(-\mezV,0)$); 

\draw[decorate sep={\triI}{\triII},fill] ($(C2)+(\mezV,0)$) to ($(C3)+(-\mezV,0)$);

\draw[decorate sep={\triI}{\triII},fill] ($(C6)+(\mezV,0)$) to ($(C7)+(-\mezV,0)$);

\draw[decorate sep={\triI}{\triII},fill] ($(D2)+(\mezV,0)$) to ($(D3)+(-\mezV,0)$);

\draw[decorate sep={\triI}{\triII},fill] ($(D6)+(\mezV,0)$) to ($(D7)+(-\mezV,0)$);

\coordinate (U1) at ($(B1)-(0,\distI)$);
\coordinate (U2) at ($(U1)+(2*\radI,0)$);
\coordinate (U3) at ($(U2)+(\mezI,0)$);
\coordinate (U4) at ($(U3)+(2*\radI,0)$);
\coordinate (U5) at ($(U1)-(0,\vysI)$);
\coordinate (U6) at ($(U5)+(2*\radI,0)$);
\coordinate (U7) at ($(U6)+(\mezI,0)$);
\coordinate (U8) at ($(U7)+(2*\radI,0)$);

\coordinate (V1) at ($(A8)+(\mezIII,0)$);
\coordinate (V2) at ($(V1)+(2*\radI,0)$);
\coordinate (V3) at ($(V2)+(\mezI,0)$);
\coordinate (V4) at ($(V3)+(2*\radI,0)$);
\coordinate (V5) at ($(V1)-(0,\vysI)$);
\coordinate (V6) at ($(V5)+(2*\radI,0)$);
\coordinate (V7) at ($(V6)+(\mezI,0)$);
\coordinate (V8) at ($(V7)+(2*\radI,0)$);

\draw (U5) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (U5) arc (180:0:{\radI} and {\ecc});
\draw (U7) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (U7) arc (180:0:{\radI} and {\ecc});
\draw (V5) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (V5) arc (180:0:{\radI} and {\ecc});
\draw (V7) arc (180:360:{\radI} and {\ecc});
\draw[dashed] (V7) arc (180:0:{\radI} and {\ecc});

\draw (U1) arc (180:360:{\radI} and {\ecc});
\draw (U1) arc (180:0:{\radI} and {\ecc});
\draw (U3) arc (180:360:{\radI} and {\ecc});
\draw (U3) arc (180:0:{\radI} and {\ecc});
\draw (V1) arc (180:360:{\radI} and {\ecc});
\draw (V1) arc (180:0:{\radI} and {\ecc});
\draw (V3) arc (180:360:{\radI} and {\ecc});
\draw (V3) arc (180:0:{\radI} and {\ecc});

\draw (U1)--(U5);
\draw (U4)--(U8);
\draw (U2)--(U6);
\draw (U3)--(U7);

\draw (V1)--(V5);
\draw (V4)--(V8);
\draw (V2)--(V6);
\draw (V3)--(V7);

\draw[decorate sep={\triI}{\triII},fill] ($(U2)+(\mezV,0)$) to ($(U3)+(-\mezV,0)$);
\draw[decorate sep={\triI}{\triII},fill] ($(U6)+(\mezV,0)$) to ($(U7)+(-\mezV,0)$);
\draw[decorate sep={\triI}{\triII},fill] ($(V2)+(\mezV,0)$) to ($(V3)+(-\mezV,0)$);
\draw[decorate sep={\triI}{\triII},fill] ($(V6)+(\mezV,0)$) to ($(V7)+(-\mezV,0)$);

\coordinate (G1) at ($(B1)+(\radI,0.5*\vysI)$);
  \draw (G1) to[out=-\geneccI,in=180+\geneccI] coordinate[pos=\gencancI] (G11) coordinate[pos=1-\gencancI] (G12) ($(G1) + (2*\genradI,0)$) ;
\draw (G11) to[out=\genecc,in=180-\genecc] (G12);

\coordinate (G2) at ($(G11)+(\distIII,0)$);
  \draw (G2) to[out=-\geneccI,in=180+\geneccI] coordinate[pos=\gencancI] (G21) coordinate[pos=1-\gencancI] (G22) ($(G2) + (2*\genradI,0)$) ;
\draw (G21) to[out=\genecc,in=180-\genecc] (G22);

\coordinate (GG2) at ($(D8)+(-2*\genradI-\radI,0.5*\vysI)$);
  \draw (GG2) to[out=-\geneccI,in=180+\geneccI] coordinate[pos=\gencancI] (GG21) coordinate[pos=1-\gencancI] (GG22) ($(GG2) + (2*\genradI,0)$) ;
\draw (GG21) to[out=\genecc,in=180-\genecc] (GG22);

\coordinate (GG1) at ($(GG2)+(-\distIII,0)$);
  \draw (GG1) to[out=-\geneccI,in=180+\geneccI] coordinate[pos=\gencancI] (GG11) coordinate[pos=1-\gencancI] (GG12) ($(GG1) + (2*\genradI,0)$) ;
\draw (GG11) to[out=\genecc,in=180-\genecc] (GG12);

\draw[decorate sep={\triI}{\triII},fill] ($(G12)+(\mezV+\gencancI,0)$) to ($(G21)+(-\mezV-\gencancI,0)$);
\draw[decorate sep={\triI}{\triII},fill] ($(GG12)+(\mezV+\gencancI,0)$) to ($(GG21)+(-\mezV-\gencancI,0)$);

\node at ($(G22)+(2*\radI,0)$) {$\mathfrak{q}_{k_1 l_1 g_1}$};
\node at ($(GG11)+(-2*\radI,0)$) {$\mathfrak{q}_{k_2 l_2 g_2}$};
\end{tikzpicture}